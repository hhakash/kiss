<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Pixel Kisses üíã</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.ably.com/lib/ably.min-1.js"></script>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
body {
background-color: #fff0f3;
font-family: 'VT323', monospace;
overflow: hidden;
touch-action: manipulation;
}

    .pixel-card {
        background: white;
        border: 4px solid #ff85a2;
        box-shadow: 8px 8px 0px #ffb3c1;
    }

    #pixel-heart {
        font-size: 8rem;
        cursor: pointer;
        transition: transform 0.1s;
        display: inline-block;
        user-select: none;
    }

    #pixel-heart:active {
        transform: scale(0.9);
    }

    .kiss-animation {
        position: absolute;
        font-size: 3rem;
        pointer-events: none;
        animation: floatUp 1.5s ease-out forwards;
        z-index: 100;
    }

    @keyframes floatUp {
        0% { transform: translateY(0) scale(1); opacity: 1; }
        100% { transform: translateY(-200px) scale(1.5); opacity: 0; }
    }

    .custom-button {
        background: #ff85a2;
        border-bottom: 4px solid #ff4d6d;
        color: white;
        text-shadow: 2px 2px #ff4d6d;
    }

    .custom-button:active {
        border-bottom: 0px;
        margin-top: 4px;
    }
</style>


</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

<!-- Login Screen -->
<div id="setup-screen" class="pixel-card p-8 w-full max-w-sm text-center">
    <h1 class="text-4xl mb-6 text-pink-600">PIXEL KISSES</h1>
    <input type="text" id="nameInput" placeholder="Enter your name..." 
           class="w-full p-3 mb-4 border-4 border-pink-200 focus:border-pink-500 outline-none text-2xl">
    <button onclick="startApp()" class="custom-button w-full py-3 text-3xl uppercase">Connect</button>
</div>

<!-- Main App Screen -->
<div id="app-screen" class="hidden w-full max-w-sm flex flex-col items-center">
    <div class="pixel-card w-full p-6 text-center mb-6">
        <h2 id="welcome-text" class="text-2xl text-pink-500 mb-2"></h2>
        <div id="pixel-heart" onclick="sendKiss()">‚ù§Ô∏è</div>
        <p class="text-xl text-gray-400 mt-2">Tap heart to send kiss!</p>
    </div>

    <div class="pixel-card w-full p-4 h-48 overflow-y-auto bg-pink-50">
        <h3 class="text-xl mb-2 text-pink-600 border-b-2 border-pink-200 uppercase">History</h3>
        <div id="messages" class="space-y-1"></div>
    </div>
</div>

<script>
    // YOUR SPECIFIC API KEY
    const ABLY_KEY = '6G9jsw.QuGn5Q:4ez2s64HviAo3pI8FhRBLPZLfsz-v3d9ItEEmd7qYPM';
    let ably, channel, myName;

    function startApp() {
        const input = document.getElementById('nameInput').value.trim();
        if (!input) return;
        
        myName = input;
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('app-screen').classList.remove('hidden');
        document.getElementById('welcome-text').innerText = `Hi ${myName}!`;

        initAbly();
    }

    function initAbly() {
        // Initialize Ably Realtime
        ably = new Ably.Realtime(ABLY_KEY);
        channel = ably.channels.get('kisses-channel');

        // Listen for incoming kisses
        channel.subscribe('kiss', (message) => {
            receiveKiss(message.data);
        });

        addLog("Status: Online üíã");
    }

    function sendKiss() {
        if (!channel) return;
        
        const kissData = { from: myName, timestamp: Date.now() };
        channel.publish('kiss', kissData);
        
        spawnKissEffect();
        addLog(`You sent a kiss!`);
    }

    function receiveKiss(data) {
        // Don't trigger if you are the sender
        if (data.from === myName) return;

        // --- ANDROID SOUND BRIDGE ---
        // This triggers the playKissSound() function in your MainActivity.kt
        if (typeof Android !== "undefined" && Android.playKissSound) {
            Android.playKissSound();
        }

        // Visual feedback
        spawnKissEffect();
        document.getElementById('pixel-heart').innerText = "üíã";
        setTimeout(() => { 
            document.getElementById('pixel-heart').innerText = "‚ù§Ô∏è"; 
        }, 2000);

        addLog(`${data.from} sent a kiss!`);
    }

    function spawnKissEffect() {
        const kiss = document.createElement('div');
        kiss.className = 'kiss-animation';
        kiss.innerText = 'üíã';
        kiss.style.left = (Math.random() * 60 + 20) + '%';
        kiss.style.top = '40%';
        document.body.appendChild(kiss);
        setTimeout(() => kiss.remove(), 1500);
    }

    function addLog(msg) {
        const box = document.getElementById('messages');
        const div = document.createElement('div');
        div.className = "text-lg text-pink-800 border-b border-pink-100";
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        div.innerText = `[${time}] ${msg}`;
        box.prepend(div);
    }
</script>


</body>
</html>
